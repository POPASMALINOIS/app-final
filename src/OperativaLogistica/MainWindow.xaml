<Window x:Class="OperativaLogistica.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="PLM INDITEX EXPEDICIÓN" Height="900" Width="1500">

    <DockPanel>

        <!-- ===== Menú superior ===== -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_Archivo">
                <MenuItem Header="Nueva pestaña" Click="NewTab_Click"/>
                <MenuItem Header="Cerrar pestaña" Click="CloseTab_Click"/>
                <Separator/>
                <MenuItem Header="Importar…" Click="Import_Click"/>
                <MenuItem Header="Exportar CSV…" Click="ExportCsv_Click"/>
                <MenuItem Header="Guardar PDF…" Click="SavePdf_Click"/>
                <Separator/>
                <MenuItem Header="Nueva jornada…" Click="NewDay_Click"/>
                <Separator/>
                <MenuItem Header="Salir" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="_Ayuda">
                <MenuItem Header="Acerca de…" Click="About_Click"/>
            </MenuItem>
        </Menu>

        <!-- ===== Barra de filtros rápida ===== -->
        <ToolBar DockPanel.Dock="Top" Padding="6">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="4,0">
                <TextBlock Text="Fecha:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                <DatePicker SelectedDate="{Binding FechaActual, Mode=TwoWay}" Width="150" />
                <TextBlock Text="   Lado:" VerticalAlignment="Center" Margin="16,0,8,0"/>
                <ComboBox Width="140"
                          ItemsSource="{Binding Config.Lados}"
                          SelectedItem="{Binding LadoSeleccionado, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
            </StackPanel>
        </ToolBar>

        <!-- ===== DataGrid principal ===== -->
        <DataGrid x:Name="dg"
                  ItemsSource="{Binding SesionActual.Operaciones}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="True"
                  IsReadOnly="False"
                  Margin="8"
                  HeadersVisibility="Column"
                  GridLinesVisibility="All"
                  SelectionMode="Extended"
                  SelectionUnit="FullRow">

            <!-- Columnas explícitas -->
            <DataGrid.Columns>
                <DataGridTextColumn Header="Id"            Binding="{Binding Id}" Width="60" />
                <DataGridTextColumn Header="Transportista" Binding="{Binding Transportista}" Width="220" />
                <DataGridTextColumn Header="Matricula"     Binding="{Binding Matricula}" Width="110" />
                <DataGridTextColumn Header="Muelle"        Binding="{Binding Muelle}" Width="90" />
                <DataGridTextColumn Header="Estado"        Binding="{Binding Estado}" Width="110" />
                <DataGridTextColumn Header="Destino"       Binding="{Binding Destino}" Width="220" />
                <DataGridTextColumn Header="Llegada"       Binding="{Binding Llegada}" Width="110" />

                <!-- LlegadaReal con icono de reloj -->
                <DataGridTemplateColumn Header="LlegadaReal" Width="120">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding LlegadaReal}" VerticalAlignment="Center" Margin="0,0,4,0"/>
                                <Button FontFamily="Segoe MDL2 Assets"
                                        Content="&#xE121;"
                                        Padding="4"
                                        MinWidth="28"
                                        Click="LlegadaRealAhora_Click"
                                        ToolTip="Poner hora actual como Llegada Real"/>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- SalidaReal con icono de reloj -->
                <DataGridTemplateColumn Header="SalidaReal" Width="120">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding SalidaReal}" VerticalAlignment="Center" Margin="0,0,4,0"/>
                                <Button FontFamily="Segoe MDL2 Assets"
                                        Content="&#xE121;"
                                        Padding="4"
                                        MinWidth="28"
                                        Click="SalidaRealAhora_Click"
                                        ToolTip="Poner hora actual como Salida Real"/>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <DataGridTextColumn Header="SalidaTope"    Binding="{Binding SalidaTope}" Width="110" />
                <DataGridTextColumn Header="Observaciones" Binding="{Binding Observaciones}" Width="300" />
                <DataGridTextColumn Header="Incidencias"   Binding="{Binding Incidencias}" Width="240" />
                <DataGridTextColumn Header="Fecha"         Binding="{Binding Fecha, StringFormat=\{0:yyyy-MM-dd\}}" Width="120" />
                <DataGridTextColumn Header="Precinto"      Binding="{Binding Precinto}" Width="120" />
                <DataGridCheckBoxColumn Header="Lex"       Binding="{Binding Lex}" Width="60" />
                <DataGridComboBoxColumn Header="Lado"
                                        Width="140"
                                        ItemsSource="{Binding DataContext.Config.Lados, RelativeSource={RelativeSource AncestorType=Window}}"
                                        SelectedItemBinding="{Binding Lado, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
            </DataGrid.Columns>
        </DataGrid>

    </DockPanel>
</Window>
